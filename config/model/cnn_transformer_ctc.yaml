# @package _global_
# CNN + Transformer encoder (replaces TDS). Same front-end, then TemporalCNN + Transformer.
module:
  _target_: emg2qwerty.lightning.CNNTransformerCTCModule
  in_features: 528  # freq * channels = (n_fft // 2 + 1) * 16
  mlp_features: [384]
  # CNN stage (local temporal features)
  cnn_layers: 3
  cnn_kernel_size: 31
  # Transformer stage (global context)
  transformer_layers: 4
  n_heads: 8
  ff_dim: null  # default 4 * d_model (3072 for d_model=768)
  dropout: 0.1
  max_len: 5000  # max sequence length for sinusoidal positional encoding
  # CR-CTC (Consistency-Regularized CTC): set use_cr_ctc=true to use CRCTCLoss
  use_cr_ctc: false
  cr_ctc_consistency_weight: 0.0  # weight for consistency between two augmented views (need second forward)
  cr_ctc_entropy_weight: 0.0      # weight for entropy regularization (less peaky posteriors)

datamodule:
  _target_: emg2qwerty.lightning.WindowedEMGDataModule
  window_length: 8000  # 4 sec windows for 2kHz EMG
  padding: [1800, 200]  # 900ms past context, 100ms future context
